require = function e(t, n, o) { function i(a, s) { if (!n[a]) { if (!t[a]) { var p = "function" == typeof require && require; if (!s && p) return p(a, !0); if (r) return r(a, !0); var c = new Error("Cannot find module '" + a + "'"); throw c.code = "MODULE_NOT_FOUND", c } var l = n[a] = { exports: {} }; t[a][0].call(l.exports, function (e) { var n = t[a][1][e]; return i(n ? n : e) }, l, l.exports, e, t, n, o) } return n[a].exports } for (var r = "function" == typeof require && require, a = 0; a < o.length; a++) i(o[a]); return i }({ 270: [function (require, module, exports) { "use strict"; var timing = require("./timing"), chrome34Fix = require("./chrome34Fix"), loadApp = require("./loadApp"), project = require("./project"), userAgentParser = require("./userAgentParser"), clientState = require("../clientState"), createCallouts = require("../callouts"), reporting = require("../reporting"), Dialog = require("../dialog"), showVideoDialog = require("../videos").showVideoDialog; window.dashboard = window.dashboard || {}, window.dashboard.project = project, window.apps = { load: loadApp, setupApp: function setupApp(appOptions) { if (!window.dashboard) throw new Error("Assume existence of window.dashboard"); timing.startTiming("Puzzle", script_path, ""); var lastSavedProgram, baseOptions = { containerId: "codeApp", Dialog: Dialog, cdoSounds: CDOSounds, position: { blockYCoordinateInterval: 25 }, onInitialize: function () { createCallouts(this.level.callouts || this.callouts), userAgentParser.isChrome34() && chrome34Fix.fixup(), (appOptions.level.projectTemplateLevelName || "applab" === appOptions.app || "gamelab" === appOptions.app) && ($("#clear-puzzle-header").hide(), project.isOwner() && $("#versions-header").show()), $(document).trigger("appInitialized") }, onAttempt: function (e) { appOptions.level.isProjectLevel || (appOptions.channel ? (delete e.program, delete e.image) : (lastSavedProgram = decodeURIComponent(e.program), clientState.writeSourceForLevel(appOptions.scriptName, appOptions.serverLevelId, +new Date, lastSavedProgram)), e.scriptName = appOptions.scriptName, e.fallbackResponse = appOptions.report.fallback_response, e.callback = appOptions.report.callback, trackEvent("Puzzle", "Attempt", script_path, e.pass ? 1 : 0), e.pass && (trackEvent("Puzzle", "Success", script_path, e.attempt), timing.stopTiming("Puzzle", script_path, "")), trackEvent("Activity", "Lines of Code", script_path, e.lines), reporting.sendReport(e)) }, onComplete: function (e) { appOptions.channel || clientState.writeSourceForLevel(appOptions.scriptName, appOptions.serverLevelId, e.timestamp, lastSavedProgram) }, onResetPressed: function () { reporting.cancelReport() }, onContinue: function () { var e = reporting.getLastServerResponse(); e.videoInfo ? showVideoDialog(e.videoInfo) : e.nextRedirect && (window.location.href = e.nextRedirect) }, backToPreviousLevel: function () { var e = reporting.getLastServerResponse(); e.previousLevelRedirect && (window.location.href = e.previousLevelRedirect) }, showInstructionsWrapper: function (e) { if (!this.share && !appOptions.level.skipInstructionsPopup) { var t = e; appOptions.level.afterVideoBeforeInstructionsFn && (t = function () { appOptions.level.afterVideoBeforeInstructionsFn(e) }); var n = !!appOptions.autoplayVideo, o = !(!appOptions.level.instructions && !appOptions.level.aniGifURL); n ? (o && (appOptions.autoplayVideo.onClose = t), showVideoDialog(appOptions.autoplayVideo)) : o && t() } } }; $.extend(!0, appOptions, baseOptions), function fixUpFunctions(node) { if ("object" == typeof node) for (var i in node) if (/^fn_/.test(i)) try { node[i.replace(/^fn_/, "")] = eval("(" + node[i] + ")") } catch (e) { } else fixUpFunctions(node[i]) }(appOptions.level), appOptions.noPadding = userAgentParser.isMobile() }, setupProjectsExternal: function () { if (!window.dashboard) throw new Error("Assume existence of window.dashboard") }, sourceHandler: { setInitialLevelHtml: function (e) { appOptions.level.levelHtml = e }, getLevelHtml: function () { return window.Applab && Applab.getHtml() }, setInitialLevelSource: function (e) { appOptions.level.lastAttempt = e }, getLevelSource: function (e) { var t; return window.Blockly ? t = Blockly.mainBlockSpace.isReadOnly() ? e : Blockly.Xml.domToText(Blockly.Xml.blockSpaceToDom(Blockly.mainBlockSpace)) : appOptions.getCode && (t = appOptions.getCode()), t } }, init: function () { project.init(window.apps.sourceHandler), window[appOptions.app + "Main"](appOptions) } } }, { "../callouts": 241, "../clientState": 242, "../dialog": 264, "../reporting": 289, "../videos": 292, "./chrome34Fix": 268, "./loadApp": 271, "./project": 272, "./timing": 274, "./userAgentParser": 275 }], 274: [function (e, t) { "use strict"; var n = {}; t.exports = { startTiming: function (e, t, o) { var i = e + t + o; n[i] = (new Date).getTime() }, stopTiming: function (e, t, o) { var i = e + t + o, r = (new Date).getTime(), a = n[i], s = r - a; ga("send", "timing", e, t, s, o) } } }, {}], 272: [function (e, t) { "use strict"; function n() { return JSON.stringify(S) } function o(e) { S = { source: e.source, html: e.html } } function i(e, t) { delete e.levelSource, delete e.levelHtml, delete e.html, u = e, T.setTitle(u.name), e.migratedToS3 ? w.fetch(u.id + "/" + y, function (e, n) { e && (console.warn("unable to fetch project source file", e), n = { source: "", html: "" }), o(n), t() }) : t() } function r(e) { b.fetch(u.id + "/abuse", function (t, n) { if (_ = n && n.abuse_score || _, e(), t) throw t }) } function a(e, t) { "function" == typeof e && e(t) } function s() { return u && u.isOwner && !u.frozen } function p() { var e = l(); if (e.action && u) { var t; return "view" === e.action && s() ? (t = location.href.replace(/(\/projects\/[^/]+\/[^/]+)\/view/, "$1/edit"), appOptions.readonlyWorkspace = !1, x = !0) : "edit" !== e.action || s() || (t = location.href.replace(/(\/projects\/[^/]+\/[^/]+)\/edit/, "$1/view"), appOptions.readonlyWorkspace = !0, x = !1), t && t !== location.href && window.history.pushState && window.history.pushState({ modified: !0 }, document.title, t), !1 } } function c() { var e = location.href.replace("#", "/"); return e === location.href ? !1 : (l(), location.href = e, !0) } function l() { var e = location.pathname; return location.hash && (e += location.hash.replace("#", "/")), "p" !== e.split("/")[A.PROJECTS] && "projects" !== e.split("/")[A.PROJECTS] ? { appName: null, channelId: null, action: null } : { appName: e.split("/")[A.APP], channelId: e.split("/")[A.CHANNEL_ID], action: e.split("/")[A.ACTION] } } var u, d, f = 3e4, h = 10, v = ["hoc2015", "infinity", "gumball", "iceage"], m = !1, g = e("./clientApi").create("/v3/assets"), w = e("./clientApi").create("/v3/sources"), b = e("./clientApi").create("/v3/channels"), O = e("../showProjectAdmin"), j = e("../header"), y = "main.json", P = { appModeChanged: "appModeChanged", appInitialized: "appInitialized", workspaceChange: "workspaceChange" }, A = { START: 0, PROJECTS: 1, APP: 2, CHANNEL_ID: 3, ACTION: 4 }, _ = 0, x = !1, S = { source: null, html: null }, T = t.exports = { getCurrentId: function () { return u ? u.id : void 0 }, getCurrentName: function () { return u ? u.name : void 0 }, getCurrentTimestamp: function () { return u ? u.updatedAt : void 0 }, getAbuseScore: function () { return _ }, adminResetAbuseScore: function () { var e = this.getCurrentId(); e && b["delete"](e + "/abuse", function (t) { if (t) throw t; g.patchAll(e, "abuse_score=0", null, function (e) { if (e) throw e; $(".admin-abuse-score").text(0) }) }) }, isFrozen: function () { return u ? u.frozen : void 0 }, isOwner: function () { return u && u.isOwner }, exceedsAbuseThreshold: function () { return _ >= h }, hideBecauseAbusive: function () { if (!this.exceedsAbuseThreshold() || appOptions.scriptId) return !1; var e = l().action; return !this.isOwner() && !appOptions.isAdmin || "edit" !== e && "view" !== e ? !0 : !1 }, isEditing: function () { return x }, isProjectLevel: function () { return appOptions.level && appOptions.level.isProjectLevel }, shouldUpdateHeaders: function () { return !appOptions.isExternalProjectLevel }, showProjectHeader: function () { this.shouldUpdateHeaders() && j.showProjectHeader() }, showMinimalProjectHeader: function () { this.shouldUpdateHeaders() && j.showMinimalProjectHeader() }, showHeaderForProjectBacked: function () { this.shouldUpdateHeaders() && j.showHeaderForProjectBacked() }, setName: function (e) { u = u || {}, e && (u.name = e, this.setTitle(e)) }, setTitle: function (e) { e && appOptions.gameDisplayName && (document.title = e + " - " + appOptions.gameDisplayName) }, init: function (e) { this.sourceHandler = e, c() || p() || (this.isProjectLevel() || u ? (S.html && e.setInitialLevelHtml(S.html), x ? (u ? S.source && e.setInitialLevelSource(S.source) : this.setName("My Project"), $(window).on(P.appModeChanged, function (e, t) { this.save(t) }.bind(this)), $(window).on(P.appInitialized, function () { S.source = this.sourceHandler.getLevelSource(S.source) }.bind(this)), $(window).on(P.workspaceChange, function () { m = !0 }), window.setInterval(this.autosave_.bind(this), f), u.hidden ? this.isFrozen() || this.showHeaderForProjectBacked() : u.isOwner || !l().channelId ? this.showProjectHeader() : this.showMinimalProjectHeader()) : u && (this.sourceHandler.setInitialLevelSource(S.source), this.showMinimalProjectHeader())) : appOptions.isLegacyShare && this.getStandaloneApp() && (this.setName("Untitled Project"), this.showMinimalProjectHeader()), appOptions.noPadding && $(".full_container").css({ padding: "0px" }), O()) }, projectChanged: function () { m = !0 }, getStandaloneApp: function () { switch (appOptions.app) { case "applab": return "applab"; case "gamelab": return "gamelab"; case "turtle": return "artist"; case "calc": return "calc"; case "eval": return "eval"; case "studio": return appOptions.level.useContractEditor ? "algebra_game" : -1 != v.indexOf(appOptions.skinId) ? null : "playlab"; default: return null } }, appToProjectUrl: function () { var e = T.getStandaloneApp(); if (!e) throw new Error("This type of project cannot be run as a standalone app."); return "/projects/" + e }, clearHtml: function () { S.html = "" }, save: function (e, t, i) { if (!u || u.isOwner !== !1) { if ("function" == typeof arguments[0] || !e) { var r = Array.prototype.slice.apply(arguments); t = r[0], i = r[1], e = { source: this.sourceHandler.getLevelSource(), html: this.sourceHandler.getLevelHtml() } } i && (d = null), $(".project_updated_at").text("Saving..."); var s = u.id; if (S.html && !e.html) throw new Error("Attempting to blow away existing levelHtml"); o(e), this.getStandaloneApp() && (u.level = this.appToProjectUrl()); var p = y + (d ? "?version=" + d : ""); w.put(s, n(), p, function (e, n) { d = n.versionId, u.migratedToS3 = !0, b.update(s, u, function (e, n) { this.updateCurrentData_(e, n, !1), a(t, n) }.bind(this)) }.bind(this)) } }, updateCurrentData_: function (e, t, n) { return e ? void $(".project_updated_at").text("Error saving project") : (u = t, n && (x && l().appName ? window.history.pushState && window.history.pushState(null, document.title, this.getPathName("edit")) : location.href = this.getPathName("edit")), void j.updateTimestamp()) }, autosave_: function () { if (null !== S.source && (appOptions.droplet || m) && 0 === $("#designModeViz .ui-draggable-dragging").length) { var e = this.sourceHandler.getLevelSource(), t = this.sourceHandler.getLevelHtml(); return S.source === e && S.html === t ? void (m = !1) : void this.save({ source: e, html: t }, function () { m = !1 }) } }, rename: function (e, t) { this.setName(e), this.save(t) }, freeze: function (e) { u.frozen = !0, u.hidden = !0, this.save(function (t) { a(e, t), p() }) }, copy: function (e, t) { var n = u.id, o = this.copyAssets.bind(this, n, t); delete u.id, delete u.hidden, this.setName(e), b.create(u, function (e, t) { this.updateCurrentData_(e, t, !0), this.save(o) }.bind(this)) }, copyAssets: function (e, t) { if (!e) return void a(t); var n = u.id; g.copyAll(e, n, function (e) { return e ? void $(".project_updated_at").text("Error copying files") : void a(t) }) }, serverSideRemix: function () { function e() { location.href = T.getPathName("remix") } if (u && !u.name) { var t = T.appToProjectUrl(); "/projects/algebra_game" === t ? this.setName("Big Game Template") : ("/projects/applab" === t || "/projects/gamelab" === t) && this.setName("My Project") } u.isOwner ? T.save(e) : e() }, createNew: function () { T.save(function () { location.href = T.appToProjectUrl() + "/new" }) }, "delete": function (e) { var t = u.id; b["delete"](t, function (t, n) { a(e, n) }) }, load: function () { var e = new $.Deferred; if (T.isProjectLevel()) { if (c() || p()) return e.resolve(), e; var t = l(); t.channelId ? ("edit" === t.action ? x = !0 : $("#betainfo").hide(), b.fetch(t.channelId, function (n, o) { n ? location.href = location.pathname.split("/").slice(A.START, A.APP + 1).join("/") : i(o, function () { u.isOwner && "view" === t.action && (x = !0), r(function () { e.resolve() }) }) })) : (x = !0, e.resolve()) } else appOptions.isChannelBacked ? (x = !0, b.fetch(appOptions.channel, function (t, n) { t ? e.reject() : i(n, function () { T.showHeaderForProjectBacked(), r(function () { e.resolve() }) }) })) : e.resolve(); return e }, getPathName: function (e) { var t = this.appToProjectUrl() + "/" + this.getCurrentId(); return e && (t += "/" + e), t } } }, { "../header": 267, "../showProjectAdmin": 290, "./clientApi": 269 }], 271: [function (e, t) { "use strict"; var n = e("./renderAbusive"), o = e("./userAgentParser"), i = e("../progress"), r = e("../clientState"), a = 5e3; t.exports = function (e) { var t = !1, s = function () { t || (t = !0, appOptions.level.lastAttempt = r.sourceForLevel(appOptions.scriptName, appOptions.serverLevelId), e()) }, p = "true" === r.queryParams("solution"), c = !!r.queryParams("user_id"); appOptions.share && !window.navigator.standalone && o.isSafari() && window.addEventListener("load", function () { addToHome.show(!0) }, !1), appOptions.channel || p || c ? window.dashboard && dashboard.project ? dashboard.project.load().then(function () { return dashboard.project.hideBecauseAbusive() ? (n(), $.Deferred().reject()) : void 0 }).then(e) : s() : (appOptions.publicCaching && (appOptions.disableSocialShare = !0), $.ajax("/api/user_progress/" + appOptions.scriptName + "/" + appOptions.stagePosition + "/" + appOptions.levelPosition).done(function (n) { appOptions.disableSocialShare = n.disableSocialShare; var o = n.progress || {}, a = r.allLevelsProgress()[appOptions.scriptName] || {}; if (Object.keys(o).forEach(function (e) { if (o[e] !== a[e]) { var t = i.mergedActivityCssClass(a[e], o[e]); $(".level-" + e).attr("class", "level_link " + t), r.trackProgress(null, null, o[e], appOptions.scriptName, e) } }), !t) if (n.lastAttempt) { t = !0; var p = n.lastAttempt.timestamp, c = n.lastAttempt.source, l = r.sourceForLevel(appOptions.scriptName, appOptions.serverLevelId, p); void 0 !== l ? appOptions.level.lastAttempt = l : c && c.length && (appOptions.level.lastAttempt = c, r.writeSourceForLevel(appOptions.scriptName, appOptions.serverLevelId, p, c)), e() } else s(); n.disablePostMilestone && $("#progresswarning").show() }).fail(s), setTimeout(s, a)) } }, { "../clientState": 242, "../progress": 287, "./renderAbusive": 273, "./userAgentParser": 275 }], 275: [function (e, t) { "use strict"; t.exports.isMobile = function () { var e = /Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/; return e.test(window.navigator.userAgent) }, t.exports.isSafari = function () { return -1 !== navigator.userAgent.indexOf("Safari") && -1 === navigator.userAgent.indexOf("Chrome") }, t.exports.isChrome34 = function () { var e = /Chrome\/34/; return e.test(window.navigator.userAgent) } }, {}], 273: [function (e, t) { "use strict"; var n = e("../components/abuse_exclamation"), o = e("../showProjectAdmin"); t.exports = function () { ReactDOM.render(React.createElement(n, { i18n: { tos: window.dashboard.i18n.t("project.abuse.tos"), contact_us: window.dashboard.i18n.t("project.abuse.contact_us"), edit_project: window.dashboard.i18n.t("project.edit_project"), go_to_code_studio: window.dashboard.i18n.t("project.abuse.go_to_code_studio") }, isOwner: dashboard.project.isOwner() }), document.getElementById("codeApp")), o() } }, { "../components/abuse_exclamation": 253, "../showProjectAdmin": 290 }], 290: [function (e, t) { "use strict"; t.exports = function () { if (0 !== $(".project_admin")) { dashboard.project.isProjectLevel() && (dashboard.project.isFrozen() ? $(".project_admin").html($('<span>&#x2744; Frozen! To use as an example, copy this id: <input type="text" disabled value="' + dashboard.project.getCurrentId() + '"/></span>')) : ($(".project_admin").html($('<button id="freeze" class="btn btn-default btn-sm">Freeze for use as an exemplar &#x2744;</button>')), $("#freeze").click(function () { dashboard.project.freeze(function () { window.location.reload() }) }))); var e = dashboard.project.getAbuseScore(); e && ($(".admin-abuse").show(), $(".admin-abuse-score").text(e), $(".admin-abuse-reset").click(function () { dashboard.project.adminResetAbuseScore() })) } } }, {}], 269: [function (e, t) { "use strict"; var n = { api_base_url: "/v3/channels", all: function (e) { $.ajax({ url: this.api_base_url, type: "get", dataType: "json" }).done(function (t) { e(null, t) }).fail(function (t, n, o) { var i = new Error("status: " + n + "; error: " + o); e(i, null) }) }, create: function (e, t) { $.ajax({ url: this.api_base_url, type: "post", contentType: "application/json; charset=utf-8", data: JSON.stringify(e) }).done(function (e) { t(null, e) }).fail(function (e, n, o) { var i = new Error("status: " + n + "; error: " + o); t(i, void 0) }) }, "delete": function (e, t) { $.ajax({ url: this.api_base_url + "/" + e + "/delete", type: "post", dataType: "json" }).done(function () { t(null, !0) }).fail(function (e, n, o) { var i = new Error("status: " + n + "; error: " + o); t(i, !1) }) }, fetch: function (e, t) { $.ajax({ url: this.api_base_url + "/" + e, type: "get", dataType: "json" }).done(function (e) { t(null, e) }).fail(function (e, n, o) { var i = new Error("status: " + n + "; error: " + o); t(i, void 0) }) }, update: function (e, t, n) { $.ajax({ url: this.api_base_url + "/" + e, type: "post", contentType: "application/json; charset=utf-8", data: JSON.stringify(t) }).done(function (e) { n(null, e) }).fail(function (e, t, o) { var i = new Error("status: " + t + "; error: " + o); n(i, !1) }) }, copyAll: function (e, t, n) { $.ajax({ url: this.api_base_url + "/" + t + "?src=" + e, type: "put" }).done(function (e) { n(null, e) }).fail(function (e, t, o) { var i = new Error("status: " + t + "; error: " + o); n(i, !1) }) }, put: function (e, t, n, o) { $.ajax({ url: this.api_base_url + "/" + e + "/" + n, type: "put", contentType: "application/json; charset=utf-8", data: t }).done(function (e) { o(null, e) }).fail(function (e, t, n) { var i = new Error("status: " + t + "; error: " + n); o(i, !1) }) }, patchAll: function (e, t, n, o) { $.ajax({ url: this.api_base_url + "/" + e + "/?" + t, type: "patch", contentType: "application/json; charset=utf-8", data: n }).done(function (e) { o(null, e) }).fail(function (e, t, n) { var i = new Error("status: " + t + "; error: " + n); o(i, !1) }) } }; t.exports = { create: function (e) { return $.extend({}, n, { api_base_url: e }) } } }, {}], 268: [function (e, t) { "use strict"; function n(e) { var t = $(e).attr("clip-path"); return t ? t.match(/\(\#(.*)\)/)[1] : void 0 } function o(e, t) { var o = $('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" />'); t && o.attr("class", t); var i = n(e), r = $("#" + i); r.insertAfter(e).add(e).wrapAll(o) } function i() { var e, t = $("#visualization>svg")[0]; if (t) { var i = {}, r = {}, a = new WebKitMutationObserver(function (t) { t.forEach(function (t) { for (e = 0; e < t.addedNodes.length; e++) { var n = t.addedNodes[e]; "image" == n.nodeName && (i[$(n).attr("id")] = n), "clipPath" == n.nodeName && (r[$(n).attr("id")] = n) } for (e = 0; e < t.removedNodes.length; e++) { var o = t.removedNodes[e]; ("image" == o.nodeName || "clipPath" == o.nodeName) && $("svg > svg:empty").remove() } }), $.each(i, function (e, t) { var a = n(t); r.hasOwnProperty(a) && (o(t), delete i[e], delete r[a]) }) }); a.observe(t, { childList: !0 }) } } function r() { $("[clip-path]").each(function (e, t) { $(t).attr("class") === a ? ($(t).attr("class", ""), o(t, a)) : o(t) }) } var a = "pegman-location"; t.exports = { fixup: function () { r(), i() } } }, {}], 253: [function (e, t) { "use strict"; var n = e("./abuse_error"), o = React.createClass({ displayName: "AbuseExclamation", propTypes: { i18n: React.PropTypes.shape({ tos: React.PropTypes.string.isRequired, contact_us: React.PropTypes.string.isRequired, edit_project: React.PropTypes.string.isRequired, go_to_code_studio: React.PropTypes.string.isRequired }).isRequired, isOwner: React.PropTypes.bool.isRequired }, render: function () { var e, t, o = "#0094ca", i = { backgroundColor: o, color: "white", maxWidth: 600, margin: "0 auto", marginTop: 20, borderRadius: 15 }, r = { width: 100, height: 100, background: "gold", borderRadius: 50, MozBorderRadius: 50, WebkitBorderRadius: 50, margin: 20, position: "relative" }, a = { fontSize: 80, position: "absolute", top: "50%", left: "50%", transform: "translate(-50%, -50%)" }, s = { paddingLeft: 0, paddingTop: 10, paddingBottom: 10, paddingRight: 20 }, p = { fontSize: 18, lineHeight: "24px", padding: 5 }; return this.props.isOwner ? (e = "edit", t = this.props.i18n.edit_project) : (e = "https:/studio.code.org", t = this.props.i18n.go_to_code_studio), React.createElement("table", { style: i }, React.createElement("tr", null, React.createElement("td", null, React.createElement("div", { style: r }, React.createElement("div", { style: a }, "!"))), React.createElement("td", { style: s }, React.createElement(n, { i18n: this.props.i18n, className: "exclamation-abuse", textStyle: p }), React.createElement("p", { className: "exclamation-abuse", style: p }, React.createElement("a", { href: e }, t))))) } }); t.exports = o }, { "./abuse_error": 252 }] }, {}, [270]);